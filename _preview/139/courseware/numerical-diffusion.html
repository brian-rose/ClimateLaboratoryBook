
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>22. A peek at numerical methods for diffusion models &#8212; The Climate Laboratory</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-43758959-2"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-43758959-2');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-43758959-2');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'courseware/numerical-diffusion';</script>
    <link rel="canonical" href="https://brian-rose.github.io/ClimateLaboratoryBook/courseware/numerical-diffusion.html" />
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="23. Ice-albedo feedback and Snowball Earth in the EBM" href="albedo-snowball.html" />
    <link rel="prev" title="21. Modeling the seasonal cycle of surface temperature" href="seasonal-cycle.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../home.html">
  
  
  
  
  
  
    <p class="title logo__title">The Climate Laboratory</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../home.html">
                    The Climate Laboratory
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Preamble</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About this Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../who-for.html">Who is the book for?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to.html">How to use this book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../attribution.html">How to cite and reuse this material</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="models-budgets-fun.html">1. Climate models, the global energy budget, and Fun with Python</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="zero-dim-ebm.html">2. Modeling the global energy budget</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="analytical-efolding.html">Advanced topic: Analytical solution of the global Energy Balance Model</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="climate-system-models.html">3. The climate system and climate models</a></li>
<li class="toctree-l1"><a class="reference internal" href="introducing-cesm.html">4. Introducing the Community Earth System Model (CESM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="climlab-intro.html">5. Building simple climate models using climlab</a></li>
<li class="toctree-l1"><a class="reference internal" href="radiation.html">6. A Brief Review of Radiation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="elementary-greenhouse.html">7. Elementary greenhouse models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="sympy-greenhouse.html">Advanced topic: Solving the two-layer grey gas model analytically with sympy</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="grey-radiation-climlab.html">8. Grey radiation modeling with climlab</a></li>
<li class="toctree-l1"><a class="reference internal" href="radiative-transfer.html">9. Modeling non-scattering radiative transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="spectral-bands.html">10. Who needs spectral bands? We do. Some baby steps…</a></li>
<li class="toctree-l1"><a class="reference internal" href="radeq.html">11. Radiative Equilibrium</a></li>
<li class="toctree-l1"><a class="reference internal" href="rce.html">12. Radiative-Convective Equilibrium</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="sensitivity-feedback.html">13. Climate sensitivity and feedback</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="advanced-sensitivity-feedback.html">Advanced topic: Climate sensitivity and feedback</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="transient-cesm.html">14. Examing the transient and equilibrium CO2 response in the CESM</a></li>
<li class="toctree-l1"><a class="reference internal" href="transient-toy.html">15. Toy models of transient warming</a></li>
<li class="toctree-l1"><a class="reference internal" href="clouds.html">16. Clouds and cloud feedback</a></li>
<li class="toctree-l1"><a class="reference internal" href="insolation.html">17. Insolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="orbital.html">18. Orbital variations, insolation, and the ice ages</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="heat-transport.html">19. Heat transport</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="advanced-heat-transport.html">Advanced topic: Heat transport decomposition</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="one-dim-ebm.html">20. The one-dimensional energy balance model</a></li>
<li class="toctree-l1"><a class="reference internal" href="seasonal-cycle.html">21. Modeling the seasonal cycle of surface temperature</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">22. A peek at numerical methods for diffusion models</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="albedo-snowball.html">23. Ice-albedo feedback and Snowball Earth in the EBM</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="advanced-albedo-feedback.html">Advanced topic: Ice albedo feedback in the EBM</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced-snowball-earth.html">Advanced topic: Snowball Earth and Large Ice Cap Instability in the EBM</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="surface-energy-balance.html">24. The surface energy balance</a></li>
<li class="toctree-l1"><a class="reference internal" href="land-ocean-contrast.html">25. Land-Ocean contrasts under climate change</a></li>
<li class="toctree-l1"><a class="reference internal" href="water-water-everywhere.html">26. Water, water everywhere!</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Assignments</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../about-assignments.html">About the assignments</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment-zero-dim-ebm.html">Assignment: Climate change in the zero-dimensional EBM</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="assignment-cesm-control.html">Assignment: Global average budgets in the CESM pre-industrial control simulation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="assignment-cesm-control-hints.html">Additional hints and guidance for CESM budgets assignment</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="assignment-simple-clouds.html">Assignment: Clouds in the Leaky Greenhouse Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment-rcm-feedback.html">Assignment: Feedbacks in the Radiative-Convective Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment-cesm-climate-change.html">Assignment: Climate change in the CESM simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment-insolation-orbit.html">Assignment: Insolation and orbital parameters</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Postamble</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://binder.projectpythia.org/v2/gh/brian-rose/ClimateLaboratoryBook/main?urlpath=tree/courseware/numerical-diffusion.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://lore.atmos.albany.edu:8000/hub/user-redirect/git-pull?repo=https%3A//github.com/brian-rose/ClimateLaboratoryBook&urlpath=tree/ClimateLaboratoryBook/courseware/numerical-diffusion.ipynb&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onJupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/courseware/numerical-diffusion.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>A peek at numerical methods for diffusion models</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-one-dimensional-diffusion-equation">1. The one-dimensional diffusion equation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discretizing-the-diffusion-operator-in-space">2. Discretizing the diffusion operator in space</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#some-notation-for-discretization-of-u-x-t">Some notation for discretization of <span class="math notranslate nohighlight">\(u(x,t)\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#discretizing-the-diffusive-flux">Discretizing the diffusive flux</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#no-flux-boundary-conditions">No-flux boundary conditions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-staggered-grid">The staggered grid</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-the-boundary-condition-on-the-staggered-grid">Implementing the boundary condition on the staggered grid</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#coding-the-discretized-diffusion-operator-in-numpy">3. Coding the discretized diffusion operator in <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-smooth-example">A smooth example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#some-non-smooth-examples">Some non-smooth examples</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discretizing-the-time-derivative">4. Discretizing the time derivative</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#now-suppose-that-you-wanted-to-double-the-spatial-resolution">Now, suppose that you wanted to <strong>double</strong> the spatial resolution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-analysis-of-the-ftcs-scheme">5. Stability analysis of the FTCS scheme</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-wavy-solution-must-not-grow-with-time">The wavy solution must not grow with time</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#we-have-just-discovered-an-important-constraint-on-the-allowable-timestep">We have just discovered an important constraint on the allowable timestep</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-tests-with-a-shorter-timestep">6. Numerical tests with a shorter timestep</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-need-for-a-more-efficient-method">7. The need for a more efficient method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implicit-time-method">8. Implicit time method</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-implicit-scheme-as-a-matrix-problem">The implicit scheme as a matrix problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-analysis-of-the-implicit-scheme">Stability analysis of the implicit scheme</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#your-homework-assignment">9. Your homework assignment</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#some-final-thoughts">Some final thoughts:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#credits">Credits</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="a-peek-at-numerical-methods-for-diffusion-models">
<h1><span class="section-number">22. </span>A peek at numerical methods for diffusion models<a class="headerlink" href="#a-peek-at-numerical-methods-for-diffusion-models" title="Link to this heading">#</a></h1>
<p>This notebook is part of <a class="reference external" href="https://brian-rose.github.io/ClimateLaboratoryBook">The Climate Laboratory</a> by <a class="reference external" href="http://www.atmos.albany.edu/facstaff/brose/index.html">Brian E. J. Rose</a>, University at Albany.</p>
<hr class="docutils" />
<p><a id='section1'></a></p>
<section id="the-one-dimensional-diffusion-equation">
<h2>1. The one-dimensional diffusion equation<a class="headerlink" href="#the-one-dimensional-diffusion-equation" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<p>Suppose that a quantity <span class="math notranslate nohighlight">\(u(x)\)</span> is mixed down-gradient by a diffusive process.</p>
<p>The diffusive flux is</p>
<div class="math notranslate nohighlight">
\[ F = - K \frac{\partial u}{\partial x} \]</div>
<p>There will be local changes in <span class="math notranslate nohighlight">\(u\)</span> wherever this flux is convergent or divergent:</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial u}{\partial t} = - \frac{\partial F}{\partial x} \]</div>
<p>Putting this together gives the classical diffusion equation in one dimension</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial u}{\partial t} = \frac{\partial}{\partial x} \left( K \frac{\partial u}{\partial x} \right) \]</div>
<p>For simplicity, we are going to limit ourselves to Cartesian geometry rather than meridional diffusion on a sphere.</p>
<p>We will also assume here that <span class="math notranslate nohighlight">\(K\)</span> is a constant, so our governing equation is</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial u}{\partial t} = K \frac{\partial^2 u}{\partial x^2} \]</div>
<p>This equation represents a time-dependent diffusion process. It is an <strong>initial-boundary value problem</strong>. We want to integrate the model forward in time to model the changes in the field <span class="math notranslate nohighlight">\(u(x)\)</span>.</p>
<hr class="docutils" />
<p><a id='section2'></a></p>
</section>
<section id="discretizing-the-diffusion-operator-in-space">
<h2>2. Discretizing the diffusion operator in space<a class="headerlink" href="#discretizing-the-diffusion-operator-in-space" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<p>Solving a differential equation on a computer always requires some approximation to represent the continuous function <span class="math notranslate nohighlight">\(u(x,t)\)</span> and its derivatives in terms of discrete quantities (arrays of numbers).</p>
<p>We have already dealt with simple discretization of the time derivative back in [Lecture 2](./Lecture02 – Solving the zero-dimensional EBM.ipynb). We used the <strong>forward Euler</strong> method to step all our of radiation models forward in time so far.</p>
<section id="some-notation-for-discretization-of-u-x-t">
<h3>Some notation for discretization of <span class="math notranslate nohighlight">\(u(x,t)\)</span><a class="headerlink" href="#some-notation-for-discretization-of-u-x-t" title="Link to this heading">#</a></h3>
<p>We will discretize time and space on grids</p>
<div class="math notranslate nohighlight">
\[ x_j , ~~~ t^n \]</div>
<p>so that</p>
<div class="math notranslate nohighlight">
\[ u_j^n = u(x_j, ~t^n) \]</div>
</section>
<section id="discretizing-the-diffusive-flux">
<h3>Discretizing the diffusive flux<a class="headerlink" href="#discretizing-the-diffusive-flux" title="Link to this heading">#</a></h3>
<p>The governing equation can be written in terms of the convergence of the diffusive flux:</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial u}{\partial t} = - \frac{\partial F}{\partial x} \]</div>
<p>It is sensible to use a <strong>centered difference</strong> to approximate this derivative:</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial F}{\partial x} \bigg|_j \approx  \frac{F_{j+\frac{1}{2}} - F_{j-\frac{1}{2}}}{x_{j+\frac{1}{2}} - x_{j-\frac{1}{2}}} \]</div>
<p>The time tendency at point <span class="math notranslate nohighlight">\(x_j\)</span> can thus be written</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial u}{\partial t} \bigg|_j  \approx - \frac{F_{j+\frac{1}{2}} - F_{j-\frac{1}{2}}}{x_{j+\frac{1}{2}} - x_{j-\frac{1}{2}}} \]</div>
<p>The flux itself depends on a spatial derivative of <span class="math notranslate nohighlight">\(u\)</span>. We will apply the same centered difference approximation. At point <span class="math notranslate nohighlight">\(x_j\)</span> this would look like</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial u}{\partial x} \approx \frac{u_{j+\frac{1}{2}} - u_{j-\frac{1}{2}}}{x_{j+\frac{1}{2}} - x_{j-\frac{1}{2}}} \]</div>
<p>But we actually want to approximate <span class="math notranslate nohighlight">\(F_{j+\frac{1}{2}}\)</span> and <span class="math notranslate nohighlight">\(F_{j-\frac{1}{2}}\)</span>, so we apply the centered difference formula at these intermediate points to get</p>
<div class="math notranslate nohighlight">
\[ F_{j+\frac{1}{2}} \approx -K \frac{u_{j+1} - u_{j}}{x_{j+1} - x_{j}} \]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[ F_{j-\frac{1}{2}} \approx -K \frac{u_{j} - u_{j-1}}{x_{j} - x_{j-1}} \]</div>
<p>Putting this all together, we can write the time tendency at <span class="math notranslate nohighlight">\(x_j\)</span> as</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial u}{\partial t} \bigg|_j  \approx K \frac{ \frac{u_{j+1} - u_{j}}{x_{j+1} - x_{j}} - \frac{u_{j} - u_{j-1}}{x_{j} - x_{j-1}}}{x_{j+\frac{1}{2}} - x_{j-\frac{1}{2}}} \]</div>
<p>We’ll make things easy on ourselves by using uniform grid spacing in <span class="math notranslate nohighlight">\(x\)</span>, so</p>
<div class="math notranslate nohighlight">
\[ x_{j+1} - x_{j} = x_{j} - x_{j-1} = x_{j+\frac{1}{2}} - x_{j-\frac{1}{2}} = \Delta x \]</div>
<p>So our final formula for the diffusive flux convergence is</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial u}{\partial t} \bigg|_j  \approx K \frac{ u_{j+1} - 2 u_{j} + u_{j-1}}{\Delta x^2} \]</div>
</section>
<section id="no-flux-boundary-conditions">
<h3>No-flux boundary conditions<a class="headerlink" href="#no-flux-boundary-conditions" title="Link to this heading">#</a></h3>
<p>Suppose the domain is <span class="math notranslate nohighlight">\(0 \le x \le 1\)</span>, with solid walls at <span class="math notranslate nohighlight">\(x=0, 1\)</span>.</p>
<p>The physical boundary condition at the walls is that there can be no flux in or out of the walls:</p>
<div class="math notranslate nohighlight">
\[ F(0) = F(1) = 0 \]</div>
<p>So the boundary conditions on <span class="math notranslate nohighlight">\(u\)</span> are</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial u}{\partial x} = 0 ~~~ \text{at} ~~~ x=0,1 \]</div>
</section>
<section id="the-staggered-grid">
<h3>The staggered grid<a class="headerlink" href="#the-staggered-grid" title="Link to this heading">#</a></h3>
<p>Suppose we have a grid of <span class="math notranslate nohighlight">\(J+1\)</span> total points between <span class="math notranslate nohighlight">\(x=0\)</span> and <span class="math notranslate nohighlight">\(x=1\)</span>, <strong>including the boundaries</strong>:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x^*_0 = 0 \)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(x^*_1 = \Delta x\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(x^*_2 = 2~\Delta x\)</span></p></li>
<li><p>…</p></li>
<li><p><span class="math notranslate nohighlight">\(x^*_j = j~\Delta x\)</span></p></li>
<li><p>…</p></li>
<li><p><span class="math notranslate nohighlight">\(x^*_{J-1} = (J-1)~\Delta x = 1 - \Delta x \)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(x^*_J = J ~ \Delta x = 1 \)</span></p></li>
</ul>
<p>Clearly then the grid spacing must be <span class="math notranslate nohighlight">\(\Delta x = 1/J\)</span>.</p>
<p>We’ll define the fluxes on this grid. The boundary conditions can thus be written</p>
<div class="math notranslate nohighlight">
\[ F_0 = F_J = 0 \]</div>
<p>Since our centered difference discretization defines <span class="math notranslate nohighlight">\(F\)</span> at points halfway between the <span class="math notranslate nohighlight">\(u\)</span> points, it is sensible to locate <span class="math notranslate nohighlight">\(u\)</span> on another grid that is offset by <span class="math notranslate nohighlight">\(\Delta x / 2\)</span>.</p>
<p>The first grid point for <span class="math notranslate nohighlight">\(u\)</span> is thus a distance <span class="math notranslate nohighlight">\(\Delta x / 2\)</span> from the wall, and there are a total of <span class="math notranslate nohighlight">\(J\)</span> points:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x_0 = \Delta x / 2\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(x_1 = \Delta x / 2 + \Delta x\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(x_2 = \Delta x / 2 + 2~\Delta x\)</span></p></li>
<li><p>…</p></li>
<li><p><span class="math notranslate nohighlight">\(x_j = \Delta x / 2 + j~\Delta x\)</span></p></li>
<li><p>…</p></li>
<li><p><span class="math notranslate nohighlight">\(x_{J-1} = \Delta x / 2 + (J-1)~\Delta x = 1 - \Delta x / 2 \)</span></p></li>
</ul>
</section>
<section id="implementing-the-boundary-condition-on-the-staggered-grid">
<h3>Implementing the boundary condition on the staggered grid<a class="headerlink" href="#implementing-the-boundary-condition-on-the-staggered-grid" title="Link to this heading">#</a></h3>
<p>At <span class="math notranslate nohighlight">\(x_0\)</span> we have</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial u}{\partial t} \bigg|_0  \approx -\frac{ F_1 - F_0}{\Delta x} \]</div>
<p>Subbing in <span class="math notranslate nohighlight">\(F_0 = 0\)</span> and the normal discretization for <span class="math notranslate nohighlight">\(F_1\)</span> gives</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial u}{\partial t} \bigg|_0  \approx K \frac{ u_1 - u_0 }{\Delta x^2} \]</div>
<p>The same procedure at the other wall yields</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial u}{\partial t} \bigg|_{J-1}  \approx - K \frac{ u_{J-1} - u_{J-2} }{\Delta x^2} \]</div>
<p>Pulling this all together we have a complete discretization of the diffusion operator including its boundary conditions:</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial u}{\partial t} \bigg|_0  \approx K \frac{ u_1 - u_0 }{\Delta x^2} \]</div>
<div class="math notranslate nohighlight">
\[ \frac{\partial u}{\partial t} \bigg|_j  \approx K \frac{ u_{j+1} - 2 u_{j} + u_{j-1}}{\Delta x^2}, ~~~~~~ j=1,...,J-2 \]</div>
<div class="math notranslate nohighlight">
\[ \frac{\partial u}{\partial t} \bigg|_{J-1}  \approx - K \frac{ u_{J-1} - u_{J-2} }{\Delta x^2} \]</div>
<hr class="docutils" />
<p><a id='section3'></a></p>
</section>
</section>
<section id="coding-the-discretized-diffusion-operator-in-numpy">
<h2>3. Coding the discretized diffusion operator in <code class="docutils literal notranslate"><span class="pre">numpy</span></code><a class="headerlink" href="#coding-the-discretized-diffusion-operator-in-numpy" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Math</span><span class="p">,</span> <span class="n">Latex</span>
</pre></div>
</div>
</div>
</div>
<p>Here we will divide our domain up into 20 grid points.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">J1</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">J</span> <span class="o">=</span> <span class="n">J1</span>
<span class="n">deltax</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">J</span>
<span class="n">display</span><span class="p">(</span><span class="n">Math</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;J = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">J</span>))
<span class="n">display</span><span class="p">(</span><span class="n">Math</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\Delta x = </span><span class="si">%0.3f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">deltax</span>))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\displaystyle J = 20\]</div>
<div class="output text_latex math notranslate nohighlight">
\[\displaystyle \Delta x = 0.050\]</div>
</div>
</div>
<p>The fluxes will be solved on the staggered grid with 21 points.</p>
<p><span class="math notranslate nohighlight">\(u\)</span> will be solved on the 20 point grid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xstag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">xstag</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">deltax</span><span class="o">/</span><span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.025 0.075 0.125 0.175 0.225 0.275 0.325 0.375 0.425 0.475 0.525 0.575
 0.625 0.675 0.725 0.775 0.825 0.875 0.925 0.975]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s one way to implement the finite difference, using array indexing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dudx</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dudx</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(19,)
</pre></div>
</div>
</div>
</div>
<p>We can also use the function <code class="docutils literal notranslate"><span class="pre">numpy.diff()</span></code> to accomplish the same thing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on function diff in module numpy:

diff(a, n=1, axis=-1, prepend=&lt;no value&gt;, append=&lt;no value&gt;)
    Calculate the n-th discrete difference along the given axis.
    
    The first difference is given by ``out[i] = a[i+1] - a[i]`` along
    the given axis, higher differences are calculated by using `diff`
    recursively.
    
    Parameters
    ----------
    a : array_like
        Input array
    n : int, optional
        The number of times values are differenced. If zero, the input
        is returned as-is.
    axis : int, optional
        The axis along which the difference is taken, default is the
        last axis.
    prepend, append : array_like, optional
        Values to prepend or append to `a` along axis prior to
        performing the difference.  Scalar values are expanded to
        arrays with length 1 in the direction of axis and the shape
        of the input array in along all other axes.  Otherwise the
        dimension and shape must match `a` except along axis.
    
        .. versionadded:: 1.16.0
    
    Returns
    -------
    diff : ndarray
        The n-th differences. The shape of the output is the same as `a`
        except along `axis` where the dimension is smaller by `n`. The
        type of the output is the same as the type of the difference
        between any two elements of `a`. This is the same as the type of
        `a` in most cases. A notable exception is `datetime64`, which
        results in a `timedelta64` output array.
    
    See Also
    --------
    gradient, ediff1d, cumsum
    
    Notes
    -----
    Type is preserved for boolean arrays, so the result will contain
    `False` when consecutive elements are the same and `True` when they
    differ.
    
    For unsigned integer arrays, the results will also be unsigned. This
    should not be surprising, as the result is consistent with
    calculating the difference directly:
    
    &gt;&gt;&gt; u8_arr = np.array([1, 0], dtype=np.uint8)
    &gt;&gt;&gt; np.diff(u8_arr)
    array([255], dtype=uint8)
    &gt;&gt;&gt; u8_arr[1,...] - u8_arr[0,...]
    255
    
    If this is not desirable, then the array should be cast to a larger
    integer type first:
    
    &gt;&gt;&gt; i16_arr = u8_arr.astype(np.int16)
    &gt;&gt;&gt; np.diff(i16_arr)
    array([-1], dtype=int16)
    
    Examples
    --------
    &gt;&gt;&gt; x = np.array([1, 2, 4, 7, 0])
    &gt;&gt;&gt; np.diff(x)
    array([ 1,  2,  3, -7])
    &gt;&gt;&gt; np.diff(x, n=2)
    array([  1,   1, -10])
    
    &gt;&gt;&gt; x = np.array([[1, 3, 6, 10], [0, 5, 6, 8]])
    &gt;&gt;&gt; np.diff(x)
    array([[2, 3, 4],
           [5, 1, 2]])
    &gt;&gt;&gt; np.diff(x, axis=0)
    array([[-1,  2,  0, -2]])
    
    &gt;&gt;&gt; x = np.arange(&#39;1066-10-13&#39;, &#39;1066-10-16&#39;, dtype=np.datetime64)
    &gt;&gt;&gt; np.diff(x)
    array([1, 1], dtype=&#39;timedelta64[D]&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(19,)
</pre></div>
</div>
</div>
</div>
<p>Here is a function that computes the diffusive flux <span class="math notranslate nohighlight">\(F\)</span> on the staggered grid, including the boundaries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">diffusive_flux</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">deltax</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1">#  Take the finite difference</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">/</span><span class="n">deltax</span>
    <span class="c1">#  add a zero as the first element (no flux on boundary)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="c1">#  add another zero as the last element (no flux on boundary)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="c1">#  flux is DOWN gradient, proportional to D</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">K</span><span class="o">*</span><span class="n">F</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diffusive_flux</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">deltax</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(21,)
</pre></div>
</div>
</div>
</div>
<p>The time tendency of <span class="math notranslate nohighlight">\(u\)</span> is just the convergence of this flux, which requires one more finite difference:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">diffusion</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">deltax</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1">#  compute flux</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">diffusive_flux</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">deltax</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="c1">#  take convergence of flux</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">F</span><span class="p">)</span> <span class="o">/</span> <span class="n">deltax</span>
</pre></div>
</div>
</div>
</div>
<section id="a-smooth-example">
<h3>A smooth example<a class="headerlink" href="#a-smooth-example" title="Link to this heading">#</a></h3>
<p>Suppose we have an initial <span class="math notranslate nohighlight">\(u\)</span> field that has a local maximum in the interior.</p>
<p>The gaussian (bell curve) function is a convenient way to create such a field.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">std</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">std</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">K</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">)</span>
<span class="n">dudt</span> <span class="o">=</span> <span class="n">diffusion</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">deltax</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$u(x)$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dudt</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$du/dt$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1523fbdc0&gt;
</pre></div>
</div>
<img alt="../_images/56d6f34c22257735c40b227181a913b97f5cd87c01a3a01ad279aa3fa290ba8d.png" src="../_images/56d6f34c22257735c40b227181a913b97f5cd87c01a3a01ad279aa3fa290ba8d.png" />
</div>
</div>
<p>Hopefully this makes sense. The diffusion is acting to smooth out <span class="math notranslate nohighlight">\(u\)</span> by reducing the peak and increasing <span class="math notranslate nohighlight">\(u\)</span> on the flanks of the gaussian bump.</p>
</section>
<section id="some-non-smooth-examples">
<h3>Some non-smooth examples<a class="headerlink" href="#some-non-smooth-examples" title="Link to this heading">#</a></h3>
<p>Use a random number generator to create some noisy initial conditions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
    <span class="n">dudt</span> <span class="o">=</span> <span class="n">diffusion</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">deltax</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dudt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/06f1b3f31a56d731217fc8b40b1c5fc8cd74abb30b9ce5c1c524af9b046bbedd.png" src="../_images/06f1b3f31a56d731217fc8b40b1c5fc8cd74abb30b9ce5c1c524af9b046bbedd.png" />
</div>
</div>
<hr class="docutils" />
<p><a id='section4'></a></p>
</section>
</section>
<section id="discretizing-the-time-derivative">
<h2>4. Discretizing the time derivative<a class="headerlink" href="#discretizing-the-time-derivative" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<p>The simplest way to discretize the time derivative is the <strong>forward Euler</strong> method:</p>
<div class="math notranslate nohighlight">
\[ \frac{d u}{dt} \bigg|^n \approx \frac{u^{n+1} - u^n}{\Delta t} \]</div>
<p>We have already used this method to step our prognostic variables forward in time.</p>
<p>Solving the above for the future value of <span class="math notranslate nohighlight">\(u\)</span> gives</p>
<div class="math notranslate nohighlight">
\[ u^{n+1} = u^n + \Delta t \frac{d u}{dt} \bigg|^n \]</div>
<p>We apply our discretization of the diffusion operator to the current value of the field <span class="math notranslate nohighlight">\(u^n_j\)</span>, to get our formula for the future values:</p>
<div class="math notranslate nohighlight">
\[ u_j^{n+1} = u_j^n + \frac{K \Delta t}{\Delta x^2} \left( u^n_{j+1} - 2 u^n_{j} + u^n_{j-1} \right)  \]</div>
<p>(except at the boundaries, where the diffusion operator is slightly different – see above).</p>
<p>Together, this scheme is known as <strong>Forward Time, Centered Space</strong> or <strong>FTCS</strong>.</p>
<p>It is very simple to implement in <code class="docutils literal notranslate"><span class="pre">numpy</span></code> code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">step_forward</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">deltax</span><span class="p">,</span> <span class="n">deltat</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">dudt</span> <span class="o">=</span> <span class="n">diffusion</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">deltax</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">u</span> <span class="o">+</span> <span class="n">deltat</span> <span class="o">*</span> <span class="n">dudt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">K</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">deltat</span> <span class="o">=</span> <span class="mf">0.125</span>
<span class="n">deltat1</span> <span class="o">=</span> <span class="n">deltat</span>

<span class="n">u0</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">)</span>
<span class="n">u1</span> <span class="o">=</span> <span class="n">step_forward</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span> <span class="n">deltax</span><span class="p">,</span> <span class="n">deltat1</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;initial&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;next&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x15271ddc0&gt;
</pre></div>
</div>
<img alt="../_images/770025ae4dbc9d53117edd3cd100ceb96b7e196dd71e022af8a4f21e3e8f32e5.png" src="../_images/770025ae4dbc9d53117edd3cd100ceb96b7e196dd71e022af8a4f21e3e8f32e5.png" />
</div>
</div>
<p>Let’s loop through a number of timesteps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  regular resolution</span>
<span class="n">J</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">deltax</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">J</span>
<span class="n">xstag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">xstag</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">deltax</span><span class="o">/</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">)</span>
<span class="n">niter</span> <span class="o">=</span> <span class="mi">11</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">step_forward</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">deltax</span><span class="p">,</span> <span class="n">deltat1</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1527715e0&gt;
</pre></div>
</div>
<img alt="../_images/ac7dbfd7671bbbcc56421b0d927983a371ca53007645c5bd1b07948cc492f87e.png" src="../_images/ac7dbfd7671bbbcc56421b0d927983a371ca53007645c5bd1b07948cc492f87e.png" />
</div>
</div>
<p>The numerics were easy to implement, and the scheme seems to work very well! The results are physically sensible.</p>
<section id="now-suppose-that-you-wanted-to-double-the-spatial-resolution">
<h3>Now, suppose that you wanted to <strong>double</strong> the spatial resolution<a class="headerlink" href="#now-suppose-that-you-wanted-to-double-the-spatial-resolution" title="Link to this heading">#</a></h3>
<p>Try setting <span class="math notranslate nohighlight">\(J=40\)</span> and repeat the above procedure.</p>
<p>What happens?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  double the resolution</span>
<span class="n">scaling_factor</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">J</span> <span class="o">=</span> <span class="n">J1</span> <span class="o">*</span> <span class="n">scaling_factor</span>
<span class="n">deltax</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">J</span>
<span class="n">xstag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">xstag</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">deltax</span><span class="o">/</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">)</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">step_forward</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">deltax</span><span class="p">,</span> <span class="n">deltat1</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x152823fa0&gt;
</pre></div>
</div>
<img alt="../_images/3d09efffc4ea3b249471c1f77cbcd9eb99b4f557352c22747a17a2ddc58787c8.png" src="../_images/3d09efffc4ea3b249471c1f77cbcd9eb99b4f557352c22747a17a2ddc58787c8.png" />
</div>
</div>
<p>Suddenly our scheme is producing numerical noise that grows in time and overwhelms to smooth physical solution we are trying to model.</p>
<p><strong>This is bad!</strong></p>
<p>What went wrong, and what can we do about it?</p>
<hr class="docutils" />
<p><a id='section5'></a></p>
</section>
</section>
<section id="stability-analysis-of-the-ftcs-scheme">
<h2>5. Stability analysis of the FTCS scheme<a class="headerlink" href="#stability-analysis-of-the-ftcs-scheme" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<p>Following <span id="id1">Press <em>et al.</em> [<a class="reference internal" href="../references.html#id10" title="William H. Press, Brian P. Flannery, Saul A. Teukolsky, and William T. Vetterling. Numerical Recipes in C. Cambridge University Press, Cambridge, U.K., 1988.">1988</a>]</span>, <em>Numerical Recipes in C: The Art of Scientific Computing</em>.</p>
<p>This is an example of the so-called <strong>von Neumann Stability Analysis</strong>. It is a form of <em>normal mode</em> analysis for a discrete system.</p>
<p>We look for normal mode solutions (i.e. wavy sines and cosines) of the finite difference equations of the form</p>
<div class="math notranslate nohighlight">
\[ u_j^n = \xi^n \exp(i~k~j~ \Delta x) \]</div>
<p>where <span class="math notranslate nohighlight">\(k\)</span> is some real number that represents a spatial wavenumber (which can have any value), and <span class="math notranslate nohighlight">\(\xi = \xi(k)\)</span> is a complex number that depends on <span class="math notranslate nohighlight">\(k\)</span>.</p>
<p>The number <span class="math notranslate nohighlight">\(\xi\)</span> is called the <strong>amplification factor</strong> at a given wavenumber <span class="math notranslate nohighlight">\(k\)</span>.</p>
<p>The question is, <strong>under what conditions do wavy solutions grow with time</strong>?  (This is bad, as it means small numerical noise will become large numerical noise and make our differencing scheme unusable)</p>
<p>Let’s substitute the normal mode solution into our finite difference equation</p>
<div class="math notranslate nohighlight">
\[ \frac{u_j^{n+1} -  u_j^n}{\Delta t} = \frac{K}{\Delta x^2} \left( u^n_{j+1} - 2 u^n_{j} + u^n_{j-1} \right)  \]</div>
<div class="math notranslate nohighlight">
\[ \frac{\xi^{n+1} \exp(i~k~j~ \Delta x) -  \xi^n \exp(i~k~j~ \Delta x)}{\Delta t} = \frac{K}{\Delta x^2} \left( \xi^n \exp(i~k~(j+1)~ \Delta x) - 2 \xi^n \exp(i~k~j~ \Delta x) + \xi^n \exp(i~k~(j-1)~ \Delta x) \right)  \]</div>
<p>Divide through by <span class="math notranslate nohighlight">\(\xi^n \exp(i~k~j~\Delta x)\)</span>:</p>
<div class="math notranslate nohighlight">
\[ \frac{\xi^{n+1}}{\xi^n} -  1 = \frac{K \Delta t}{\Delta x^2} \left(\exp(i~k~\Delta x) - 2 + \exp(-i~k~\Delta x) \right)  \]</div>
<p>The exponentials simplify</p>
<div class="math notranslate nohighlight">
\[ \frac{\xi^{n+1}}{\xi^n} = 1 + \frac{K \Delta t}{\Delta x^2} \left(2 \cos(k~\Delta x) - 2 \right)  \]</div>
<p>Or using a double angle identity,</p>
<div class="math notranslate nohighlight">
\[ \frac{\xi^{n+1}}{\xi^n} = 1 - \frac{4 K \Delta t}{\Delta x^2} \sin^2 \left( \frac{k~\Delta x}{2} \right)  \]</div>
<section id="the-wavy-solution-must-not-grow-with-time">
<h3>The wavy solution must not grow with time<a class="headerlink" href="#the-wavy-solution-must-not-grow-with-time" title="Link to this heading">#</a></h3>
<p>We need to prevent growing normal modes. So successive amplitudes should be</p>
<div class="math notranslate nohighlight">
\[ \bigg| \frac{\xi^{n+1}}{\xi^n} \bigg| \le 1 \]</div>
<p>The stability condition is thus</p>
<div class="math notranslate nohighlight">
\[ \bigg| 1 - \frac{4 K \Delta t}{\Delta x^2} \sin^2 \left( \frac{k~\Delta x}{2} \right) \bigg| \le 1 \]</div>
<p>and this condition must be met for <strong>EVERY</strong> possible wavenumber <span class="math notranslate nohighlight">\(k\)</span>.</p>
<p>Because <span class="math notranslate nohighlight">\(0 \le \sin^2(\phi) \le 1\)</span> for any <span class="math notranslate nohighlight">\(\phi\)</span>, our condition can only be violated if</p>
<div class="math notranslate nohighlight">
\[ \frac{4 K \Delta t}{\Delta x^2} &gt; 2 \]</div>
<p>We conclude the the FTCS scheme is stable so long as this stability condition is met:</p>
<div class="math notranslate nohighlight">
\[ \Delta t \le \frac{\Delta x^2}{2 K} \]</div>
</section>
<section id="we-have-just-discovered-an-important-constraint-on-the-allowable-timestep">
<h3>We have just discovered an important constraint on the allowable timestep<a class="headerlink" href="#we-have-just-discovered-an-important-constraint-on-the-allowable-timestep" title="Link to this heading">#</a></h3>
<p>The maximum timestep we can use with the FTCS scheme for the diffusion equation is proportional to <span class="math notranslate nohighlight">\(\Delta x^2\)</span>.</p>
<p><strong>A doubling of the spatial resolution would require a 4x shorter timestep to preserve numerical stability.</strong></p>
<p>Physically, the restriction is that the maximum allowable timestep is approximately the diffusion time across a grid cell of width <span class="math notranslate nohighlight">\(\Delta x\)</span>.</p>
<hr class="docutils" />
<p><a id='section6'></a></p>
</section>
</section>
<section id="numerical-tests-with-a-shorter-timestep">
<h2>6. Numerical tests with a shorter timestep<a class="headerlink" href="#numerical-tests-with-a-shorter-timestep" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<p>Going back to our Gaussian example, let’s double the resolution but shorten the timestep by a factor of 4.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  double the resolution</span>
<span class="n">J</span> <span class="o">=</span> <span class="n">J1</span> <span class="o">*</span> <span class="n">scaling_factor</span>
<span class="n">deltax</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">J</span>
<span class="n">xstag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">xstag</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">deltax</span><span class="o">/</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">K</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="c1">#  The maximum stable timestep</span>
<span class="n">deltat_max</span> <span class="o">=</span> <span class="n">deltax</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">K</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;The maximum allowable timestep is </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">deltat_max</span>)

<span class="n">deltat</span> <span class="o">=</span> <span class="n">deltat1</span> <span class="o">/</span> <span class="n">scaling_factor</span><span class="o">**</span><span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;4x the previous timestep is </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">deltat</span>)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The maximum allowable timestep is 0.031250
4x the previous timestep is 0.031250
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">)</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">scaling_factor</span><span class="o">**</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">step_forward</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">deltax</span><span class="p">,</span> <span class="n">deltat</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x103360fa0&gt;
</pre></div>
</div>
<img alt="../_images/2c909c9beb8cfbcc2bf9f09d6171deb7c244dc0dd12c62569e49bd4ea767e842.png" src="../_images/2c909c9beb8cfbcc2bf9f09d6171deb7c244dc0dd12c62569e49bd4ea767e842.png" />
</div>
</div>
<p>Success! The graph now looks like a smoother (higher resolution) version of our first integration with the coarser grid.</p>
<p><strong>But at a big cost</strong>:  our calculation required 4 times more timesteps to do the same integration.</p>
<p>The total increase in computational cost was actally a factor of 8 to get a factor of 2 increase in spatial resolution.</p>
<hr class="docutils" />
<p><a id='section7'></a></p>
</section>
<section id="the-need-for-a-more-efficient-method">
<h2>7. The need for a more efficient method<a class="headerlink" href="#the-need-for-a-more-efficient-method" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<p>In practice the condition</p>
<div class="math notranslate nohighlight">
\[ \Delta t \le \frac{\Delta x^2}{2 K} \]</div>
<p>is often too restrictive to be practical!</p>
<p>Consider our diffusive EBM. Suppose we want a spatial resolution of 1º latitude. Then we have 180 grid points from pole to pole, and our physical length scale is</p>
<div class="math notranslate nohighlight">
\[ \Delta x \approx 10^5 \text{m} \]</div>
<p>We were using a diffusivity of <span class="math notranslate nohighlight">\(D = 0.6 ~ \text{W m}^{-2}~\text{K}^{-1}\)</span> and a heat capacity of <span class="math notranslate nohighlight">\(C = 4 \times 10^7 ~ \text{J m}^{-2} ~\text{K}^{-1}\)</span> (for 10 m of water, <a class="reference internal" href="#./Lecture17%20--%20Seasonal%20cycle%20and%20heat%20capacity.ipynb"><span class="xref myst">see Lecture 17</span></a>).</p>
<p>Accounting for the spherical geometry in our EBM, this translates to</p>
<div class="math notranslate nohighlight">
\[ K = \frac{2 \pi a^2 D}{C} = \frac{2 \pi ~ (6.4 \times 10^6 ~\text{m})^2 ~(0.6 ~ \text{W m}^{-2}~\text{K}^{-1})}{4 \times 10^7 ~ \text{J m}^{-2} ~\text{K}^{-1}} \approx 4 \times 10^{6} ~ \text{m}^2 ~ \text{s}^{-1} \]</div>
<p>Recall that this is the diffusivity associated with the large-scale motion of the atmosphere (mostly). If we take a typical velocity scale for a mid-latitude eddy, <span class="math notranslate nohighlight">\(V \approx 20~\text{m s}^{-1}\)</span>, and a typical length scale for that eddy, <span class="math notranslate nohighlight">\(L \approx 2000~\text{km}\)</span>, the diffusivity then scales as</p>
<div class="math notranslate nohighlight">
\[ K = V~ L = 4 \times 10^{6} ~ \text{m}^2 ~ \text{s}^{-1} \]</div>
<p>Using these numbers the stability condition is roughly</p>
<div class="math notranslate nohighlight">
\[ \Delta t \le 10^3 ~\text{s}\]</div>
<p>which is less than one hour!</p>
<p>And if we wanted to double the resolution to 0.5º, we would need a timestep of just a few minutes.</p>
<p>This can be a very onerous requirement for a model that would like to integrate out for many years.  <strong>We can do better, but we need a different time discretization!</strong></p>
<hr class="docutils" />
<p><a id='section8'></a></p>
</section>
<section id="implicit-time-method">
<h2>8. Implicit time method<a class="headerlink" href="#implicit-time-method" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<p>With numerical methods for partial differential equations, it often turns out that a small change in the discretization can make an enormous difference in the results.</p>
<p>The <strong>implicit time</strong> scheme applies exactly the same centered difference scheme to the spatial derivatives in the diffusion operator.</p>
<p>But instead of applying the operator to the field <span class="math notranslate nohighlight">\(u^n\)</span> at time <span class="math notranslate nohighlight">\(n\)</span>, we instead apply it to the field <strong>at the future time</strong> <span class="math notranslate nohighlight">\(u^{n+1}\)</span>.</p>
<p>The scheme looks like</p>
<div class="math notranslate nohighlight">
\[ \frac{u_j^{n+1} - u_j^n}{\Delta t} =  \frac{K}{\Delta x^2} \left( u^{n+1}_{j+1} - 2 u^{n+1}_{j} + u^{n+1}_{j-1} \right)  \]</div>
<p>in the interior, and at the boundaries:</p>
<div class="math notranslate nohighlight">
\[ \frac{u_0^{n+1} - u_0^n}{\Delta t} = \frac{K}{\Delta x^2} \left( u^{n+1}_1 - u^{n+1}_0 \right) \]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[ \frac{u_{J-1}^{n+1} - u_{J-1}^n}{\Delta t} = - \frac{K}{\Delta x^2} \left( u_{J-1}^{n+1} - u_{J-2}^{n+1} \right) \]</div>
<p>This might seem like a strange way to write the system, since <strong>we don’t know the future state of the system at <span class="math notranslate nohighlight">\(t^{n+1}\)</span></strong>. That’s what we’re trying to solve for!</p>
<p>Let’s move all terms evaluated at <span class="math notranslate nohighlight">\(t^{n+1}\)</span> to the left hand side:</p>
<div class="math notranslate nohighlight">
\[ u_j^{n+1}  - \frac{K \Delta t}{\Delta x^2} \left( u^{n+1}_{j+1} - 2 u^{n+1}_{j} + u^{n+1}_{j-1} \right) = u_j^n   \]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[ -K^* u^{n+1}_{j+1} + \left(1+2K^* \right) u_j^{n+1} - K^* u_{j-1}^{n+1} = u_j^n \]</div>
<p>(in the interior)</p>
<p>where we have introduced a non-dimensional diffusivity</p>
<div class="math notranslate nohighlight">
\[ K^* = \frac{K \Delta t}{\Delta x^2} \]</div>
<section id="the-implicit-scheme-as-a-matrix-problem">
<h3>The implicit scheme as a matrix problem<a class="headerlink" href="#the-implicit-scheme-as-a-matrix-problem" title="Link to this heading">#</a></h3>
<p>We can write this as a matrix equation</p>
<div class="math notranslate nohighlight">
\[ \mathbf{A} ~ \mathbf{U}^{n+1} = \mathbf{U}^n \]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{U}\)</span> is a <span class="math notranslate nohighlight">\(J\times1\)</span> column vector giving the field <span class="math notranslate nohighlight">\(u(x)\)</span> at a particular instant in time:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \mathbf{U}^n = \left[ \begin{array}{c} 
u^n_0 \\
u^n_1  \\
u^n_2 \\
...  \\
u^n_{J-2} \\
u^n_{J-1} \\
\end{array}
\right] 
\end{split}\]</div>
<p>and <span class="math notranslate nohighlight">\(\mathbf{U}^{n+1}\)</span> is the same vector at <span class="math notranslate nohighlight">\(t^{n+1}\)</span>.</p>
<p><span class="math notranslate nohighlight">\(\mathbf{A}\)</span> is a <span class="math notranslate nohighlight">\(J\times J\)</span> tridiagonal matrix:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \mathbf{A} = \left[ \begin{array}{cccccccc}
 1+K^* &amp; -K^* &amp; 0 &amp; 0 &amp; ... &amp; 0 &amp; 0 &amp; 0 \\
 -K^* &amp; 1+2K^* &amp; -K^* &amp; 0 &amp; ... &amp; 0 &amp; 0 &amp; 0 \\
 0 &amp; -K^* &amp; 1+2K^* &amp; -K^* &amp;... &amp; 0 &amp; 0 &amp; 0 \\
 ... &amp; ... &amp; ... &amp; ... &amp; ... &amp; ... &amp; ... &amp; ... \\
 0 &amp; 0 &amp; 0 &amp; 0 &amp; ... &amp; -K^* &amp; 1+2K^* &amp; -K^* \\
 0 &amp; 0 &amp; 0 &amp; 0 &amp; ... &amp; 0 &amp; -K^* &amp; 1+K^* \\
\end{array}
\right] 
\end{split}\]</div>
<p>Solving for the future state of the system <span class="math notranslate nohighlight">\(\mathbf{U}^{n+1}\)</span> is then just the solution of the linear system</p>
<div class="math notranslate nohighlight">
\[ \mathbf{U}^{n+1} = \mathbf{A}^{-1} \mathbf{U}^{n}\]</div>
<p>Solving a tridiagonal matrix problem like this is a very common operation in computer science, and efficient numerical routines are available in many languages (including Python / <code class="docutils literal notranslate"><span class="pre">numpy</span></code>!)</p>
</section>
<section id="stability-analysis-of-the-implicit-scheme">
<h3>Stability analysis of the implicit scheme<a class="headerlink" href="#stability-analysis-of-the-implicit-scheme" title="Link to this heading">#</a></h3>
<p>We’ll skip the details, but the amplification factor for this scheme is (see <em>Numerical Recipes</em> book or other text on numerical methods):</p>
<div class="math notranslate nohighlight">
\[ \frac{\xi^{n+1}}{\xi^n} = \frac{1}{1+4 K^* \sin^2 \left( \frac{k \Delta x}{2} \right) } \]</div>
<p>so the stability criterion of $<span class="math notranslate nohighlight">\( \bigg| \frac{\xi^{n+1}}{\xi^n} \bigg| \le 1 \)</span>$</p>
<p>is met for any value of <span class="math notranslate nohighlight">\(K^*\)</span> and thus <strong>for any timestep <span class="math notranslate nohighlight">\(\Delta t\)</span></strong>.</p>
<p>The implicit method (also called <strong>backward time</strong>) is unconditionally stable for any choice of timestep.</p>
<hr class="docutils" />
<p><a id='section9'></a></p>
</section>
</section>
<section id="your-homework-assignment">
<h2>9. Your homework assignment<a class="headerlink" href="#your-homework-assignment" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<p>Write Python code to solve the diffusion equation using this implicit time method. Demonstrate that it is numerically stable for much larger timesteps than we were able to use with the forward-time method. One way to do this is to use a much higher spatial resolution.</p>
<section id="some-final-thoughts">
<h3>Some final thoughts:<a class="headerlink" href="#some-final-thoughts" title="Link to this heading">#</a></h3>
<p>We have just scratched the surface of the wonders and sorrows of numerical methods here. The implicit method is very <strong>stable</strong> but is not the most <strong>accurate</strong> method for a diffusion problem, particularly when you are interested in some of the faster dynamics of the system (as opposed to just getting the system quickly to its equilibrium state).</p>
<p>There are always trade-offs in the choice of a numerical method.</p>
<p>The equations for most climate models are sufficiently complex that more than one numerical method is necessary. Even in the simple diffusive EBM, the radiation terms are handled by a forward-time method while the diffusion term is solved implicitly.</p>
<p>Once you have worked through the above problem (diffusion only), you might want to look in the <code class="docutils literal notranslate"><span class="pre">climlab</span></code> code to see how the diffusion solver is implemented there, and how it is used when you integrate the EBM.</p>
</section>
</section>
<hr class="docutils" />
<section id="credits">
<h2>Credits<a class="headerlink" href="#credits" title="Link to this heading">#</a></h2>
<p>This notebook is part of <a class="reference external" href="https://brian-rose.github.io/ClimateLaboratoryBook">The Climate Laboratory</a>, an open-source textbook developed and maintained by <a class="reference external" href="http://www.atmos.albany.edu/facstaff/brose/index.html">Brian E. J. Rose</a>, University at Albany.</p>
<p>It is licensed for free and open consumption under the
<a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International (CC BY 4.0)</a> license.</p>
<p>Development of these notes and the <a class="reference external" href="https://github.com/climlab/climlab">climlab software</a> is partially supported by the National Science Foundation under award AGS-1455071 to Brian Rose. Any opinions, findings, conclusions or recommendations expressed here are mine and do not necessarily reflect the views of the National Science Foundation.</p>
<hr class="docutils" />
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./courseware"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="seasonal-cycle.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">21. </span>Modeling the seasonal cycle of surface temperature</p>
      </div>
    </a>
    <a class="right-next"
       href="albedo-snowball.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">23. </span>Ice-albedo feedback and Snowball Earth in the EBM</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-one-dimensional-diffusion-equation">1. The one-dimensional diffusion equation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discretizing-the-diffusion-operator-in-space">2. Discretizing the diffusion operator in space</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#some-notation-for-discretization-of-u-x-t">Some notation for discretization of <span class="math notranslate nohighlight">\(u(x,t)\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#discretizing-the-diffusive-flux">Discretizing the diffusive flux</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#no-flux-boundary-conditions">No-flux boundary conditions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-staggered-grid">The staggered grid</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-the-boundary-condition-on-the-staggered-grid">Implementing the boundary condition on the staggered grid</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#coding-the-discretized-diffusion-operator-in-numpy">3. Coding the discretized diffusion operator in <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-smooth-example">A smooth example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#some-non-smooth-examples">Some non-smooth examples</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discretizing-the-time-derivative">4. Discretizing the time derivative</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#now-suppose-that-you-wanted-to-double-the-spatial-resolution">Now, suppose that you wanted to <strong>double</strong> the spatial resolution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-analysis-of-the-ftcs-scheme">5. Stability analysis of the FTCS scheme</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-wavy-solution-must-not-grow-with-time">The wavy solution must not grow with time</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#we-have-just-discovered-an-important-constraint-on-the-allowable-timestep">We have just discovered an important constraint on the allowable timestep</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-tests-with-a-shorter-timestep">6. Numerical tests with a shorter timestep</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-need-for-a-more-efficient-method">7. The need for a more efficient method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implicit-time-method">8. Implicit time method</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-implicit-scheme-as-a-matrix-problem">The implicit scheme as a matrix problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-analysis-of-the-implicit-scheme">Stability analysis of the implicit scheme</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#your-homework-assignment">9. Your homework assignment</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#some-final-thoughts">Some final thoughts:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#credits">Credits</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Brian E. J. Rose
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>