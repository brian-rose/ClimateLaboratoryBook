
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>24. The surface energy balance &#8212; The Climate Laboratory</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.c441f2ba0852f4cabcb80105e3a46ae6.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="canonical" href="https://brian-rose.github.io/ClimateLaboratoryBook/courseware/surface-energy-balance.html" />
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="25. Land-Ocean contrasts under climate change" href="land-ocean-contrast.html" />
    <link rel="prev" title="Advanced topic: Snowball Earth and Large Ice Cap Instability in the EBM" href="advanced-snowball-earth.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />


<!-- Opengraph tags -->
<meta property="og:url"         content="https://brian-rose.github.io/ClimateLaboratoryBook/courseware/surface-energy-balance.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="The surface energy balance" />
<meta property="og:description" content="The surface energy balance  This notebook is part of The Climate Laboratory by Brian E. J. Rose, University at Albany.    &lt;a id=&#39;section1&#39;&gt;&lt;/a&gt;  1. Energy excha" />


<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">The Climate Laboratory</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../home.html">
   The Climate Laboratory
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Preamble
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../about.html">
   About this Book
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../who-for.html">
   Who is the book for?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../how-to.html">
   How to use this book
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../attribution.html">
   How to cite and reuse this material
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="models-budgets-fun.html">
   1. Climate models, the global energy budget, and Fun with Python
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="zero-dim-ebm.html">
   2. Modeling the global energy budget
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="analytical-efolding.html">
     Advanced topic: Analytical solution of the global Energy Balance Model
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="climate-system-models.html">
   3. The climate system and climate models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="introducing-cesm.html">
   4. Introducing the Community Earth System Model (CESM)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="climlab-intro.html">
   5. Building simple climate models using climlab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="radiation.html">
   6. A Brief Review of Radiation
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="elementary-greenhouse.html">
   7. Elementary greenhouse models
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="sympy-greenhouse.html">
     Advanced topic: Solving the two-layer grey gas model analytically with sympy
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="grey-radiation-climlab.html">
   8. Grey radiation modeling with climlab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="radiative-transfer.html">
   9. Modeling non-scattering radiative transfer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="spectral-bands.html">
   10. Who needs spectral bands? We do. Some baby steps…
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="radeq.html">
   11. Radiative Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rce.html">
   12. Radiative-Convective Equilibrium
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="sensitivity-feedback.html">
   13. Climate sensitivity and feedback
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="advanced-sensitivity-feedback.html">
     Advanced topic: Climate sensitivity and feedback
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="transient-cesm.html">
   14. Examing the transient and equilibrium CO
   <span class="math notranslate nohighlight">
    \(_2\)
   </span>
   response in the CESM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="transient-toy.html">
   15. Toy models of transient warming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="clouds.html">
   16. Clouds and cloud feedback
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="insolation.html">
   17. Insolation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="orbital.html">
   18. Orbital variations, insolation, and the ice ages
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="heat-transport.html">
   19. Heat transport
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="advanced-heat-transport.html">
     Advanced topic: Heat transport decomposition
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="one-dim-ebm.html">
   20. The one-dimensional energy balance model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="seasonal-cycle.html">
   21. Modeling the seasonal cycle of surface temperature
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numerical-diffusion.html">
   22. A peek at numerical methods for diffusion models
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="albedo-snowball.html">
   23. Ice-albedo feedback and Snowball Earth in the EBM
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="advanced-albedo-feedback.html">
     Advanced topic: Ice albedo feedback in the EBM
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="advanced-snowball-earth.html">
     Advanced topic: Snowball Earth and Large Ice Cap Instability in the EBM
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   24. The surface energy balance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="land-ocean-contrast.html">
   25. Land-Ocean contrasts under climate change
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="water-water-everywhere.html">
   26. Water, water everywhere!
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Assignments
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../about-assignments.html">
   About the assignments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="assignment-zero-dim-ebm.html">
   Assignment: Climate change in the zero-dimensional EBM
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="assignment-cesm-control.html">
   Assignment: Global average budgets in the CESM pre-industrial control simulation
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="assignment-cesm-control-hints.html">
     Additional hints and guidance for CESM budgets assignment
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="assignment-simple-clouds.html">
   Assignment: Clouds in the Leaky Greenhouse Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="assignment-rcm-feedback.html">
   Assignment: Feedbacks in the Radiative-Convective Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="assignment-cesm-climate-change.html">
   Assignment: Climate change in the CESM simulations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="assignment-insolation-orbit.html">
   Assignment: Insolation and orbital parameters
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../references.html">
   References
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/courseware/surface-energy-balance.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/brian-rose/ClimateLaboratoryBook/master?urlpath=tree/courseware/surface-energy-balance.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://lore.atmos.albany.edu:8000/hub/user-redirect/git-pull?repo=https://github.com/brian-rose/ClimateLaboratoryBook&urlpath=tree/ClimateLaboratoryBook/courseware/surface-energy-balance.ipynb&branch=master"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#energy-exchange-mechanisms-at-the-earth-s-surface">
   1. Energy exchange mechanisms at the Earth’s surface
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#major-terms-in-the-surface-energy-budget">
     Major terms in the surface energy budget
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#minor-terms-in-the-surface-energy-budget">
     Minor terms in the surface energy budget
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-surface-energy-budget-in-cesm-simulations">
   2. The surface energy budget in CESM simulations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#first-load-the-data">
     First, load the data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#annual-mean-surface-energy-budget">
     Annual mean surface energy budget
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-anomalies-for-all-terms">
     Compute anomalies for all terms
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-the-annual-mean-net-upward-flux-f-s-control-and-anomaly-after-warming">
     Plot the annual mean net upward flux
     <span class="math notranslate nohighlight">
      \(F_S\)
     </span>
     (control and anomaly after warming)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#variation-of-energy-balance-components-with-latitude">
     Variation of energy balance components with latitude
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#seasonal-variations">
     Seasonal variations
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sensible-and-latent-heat-fluxes-in-the-boundary-layer">
   3. Sensible and Latent Heat Fluxes in the boundary layer
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bulk-aerodynamic-formulas">
     Bulk aerodynamic formulas
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-bowen-ratio">
     The Bowen ratio
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-bowen-ratio-for-wet-surfaces">
     The Bowen ratio for wet surfaces
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-equilibrium-bowen-ratio-for-saturated-air">
     The equilibrium Bowen ratio (for saturated air)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bowen-ratio-in-cesm-simulations">
   4. Bowen ratio in CESM simulations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#credits">
   Credits
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="the-surface-energy-balance">
<h1><span class="section-number">24. </span>The surface energy balance<a class="headerlink" href="#the-surface-energy-balance" title="Permalink to this headline">¶</a></h1>
<p>This notebook is part of <a class="reference external" href="https://brian-rose.github.io/ClimateLaboratoryBook">The Climate Laboratory</a> by <a class="reference external" href="http://www.atmos.albany.edu/facstaff/brose/index.html">Brian E. J. Rose</a>, University at Albany.</p>
<hr class="docutils" />
<p><a id='section1'></a></p>
<div class="section" id="energy-exchange-mechanisms-at-the-earth-s-surface">
<h2>1. Energy exchange mechanisms at the Earth’s surface<a class="headerlink" href="#energy-exchange-mechanisms-at-the-earth-s-surface" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<p>The surface of the Earth is the boundary between the atmosphere and the land, ocean, or ice. Understanding the energy fluxes across the surface are very important for three main reasons:</p>
<ol class="simple">
<li><p>We are most interested in the climate at the surface because we live at the surface.</p></li>
<li><p>The surface energy budget determines how much energy is available to evaporate water and moisten the atmosphere.</p></li>
<li><p>Air-sea energy fluxes set the thermal structure of the oceans, which in turn act to redistribute energy around the planet, with many important consequences for climate.</p></li>
</ol>
<p>The energy budget at the surface is more complex that the budget at the top of the atmosphere. At the TOA the only energy transfer mechanisms are radiative (shortwave and longwave). At the surface, in addition to radiation we need to consider fluxes of energy by conduction and by convection of heat and moisture through turbulent fluid motion.</p>
<div class="section" id="major-terms-in-the-surface-energy-budget">
<h3>Major terms in the surface energy budget<a class="headerlink" href="#major-terms-in-the-surface-energy-budget" title="Permalink to this headline">¶</a></h3>
<p>We will denote the <strong>net upward energy flux at the surface</strong> as <span class="math notranslate nohighlight">\(F_S\)</span>.</p>
<p>As we mentioned back in [Lecture 15 on heat transport](./Lecture15 – Heat transport.ipynb), there are four principal contributions to <span class="math notranslate nohighlight">\(F_S\)</span>:</p>
<ol class="simple">
<li><p>Shortwave radiation</p></li>
<li><p>Longwave radiation</p></li>
<li><p>Sensible heat flux</p></li>
<li><p>Evaporation or latent heat flux</p></li>
</ol>
<p>Wherever <span class="math notranslate nohighlight">\(F_S \ne 0\)</span>, there is a net flux of energy between the atmosphere and the surface below. This implies either that there is heat storage / release occuring below the surface (e.g. warming or cooling of water, melting of snow and ice), and/or there is horizontal heat transport by fluid motions occuring below the surface (ocean circulation, groundwater flow).</p>
</div>
<div class="section" id="minor-terms-in-the-surface-energy-budget">
<h3>Minor terms in the surface energy budget<a class="headerlink" href="#minor-terms-in-the-surface-energy-budget" title="Permalink to this headline">¶</a></h3>
<p>All of these terms are small globally but can be significant locally or seasonally.</p>
<ul class="simple">
<li><p>Latent heat of fusion required for melting ice and snow</p></li>
<li><p>Conversion of the kinetic energy of winds and waves to thermal energy</p></li>
<li><p>Heat transport by precipitation, if precipitation is at a different temperature than the surface</p></li>
<li><p>Biological uptake of solar energy through photosynthesis</p></li>
<li><p>Biological release of energy through oxidation (respiration, decay, fires)</p></li>
<li><p>Geothermal heat sources (hot springs, volcanoes, etc.)</p></li>
<li><p>Anthropogenic heat released through fossil fuel burning and nuclear power generation.</p></li>
</ul>
<hr class="docutils" />
<p><a id='section2'></a></p>
</div>
</div>
<div class="section" id="the-surface-energy-budget-in-cesm-simulations">
<h2>2. The surface energy budget in CESM simulations<a class="headerlink" href="#the-surface-energy-budget-in-cesm-simulations" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<p>We will examine the surface budget in the CESM slab ocean simulations. The advantage of looking at surface fluxes in a model rather than observations is that the model fluxes are completely consistent with the model climate, so that the net flux <span class="math notranslate nohighlight">\(F_S\)</span> will be a meaningful measure of the heat storage in the system.</p>
<p>The model also gives us an opportunity to look at how the surface budget reponds to global warming under a doubling of CO<span class="math notranslate nohighlight">\(_2\)</span>.</p>
<div class="section" id="first-load-the-data">
<h3>First, load the data<a class="headerlink" href="#first-load-the-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">from</span> <span class="nn">climlab</span> <span class="kn">import</span> <span class="n">constants</span> <span class="k">as</span> <span class="n">const</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datapath</span> <span class="o">=</span> <span class="s2">&quot;http://thredds.atmos.albany.edu:8080/thredds/dodsC/cesm/&quot;</span>
<span class="n">topo</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">datapath</span><span class="o">+</span><span class="s1">&#39;som_input/USGS-gtopo30_1.9x2.5_remap_c050602.nc&#39;</span><span class="p">,</span> <span class="n">decode_times</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">runlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">,</span> <span class="s1">&#39;2xCO2&#39;</span><span class="p">]</span>
<span class="n">runs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runlist</span><span class="p">:</span>
    <span class="n">runstr</span> <span class="o">=</span> <span class="s1">&#39;som_&#39;</span> <span class="o">+</span> <span class="n">run</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">datapath</span> <span class="o">+</span> <span class="n">runstr</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">runstr</span> <span class="o">+</span> <span class="s1">&#39;.cam.h0.clim.nc&#39;</span>
    <span class="n">runs</span><span class="p">[</span><span class="n">run</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">decode_times</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="nn">~/opt/anaconda3/envs/climlab-courseware/lib/python3.8/site-packages/xarray/backends/file_manager.py</span> in <span class="ni">_acquire_with_cache_info</span><span class="nt">(self, needs_lock)</span>
<span class="g g-Whitespace">    </span><span class="mi">198</span>             <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">199</span>                 <span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">200</span>             <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>

<span class="nn">~/opt/anaconda3/envs/climlab-courseware/lib/python3.8/site-packages/xarray/backends/lru_cache.py</span> in <span class="ni">__getitem__</span><span class="nt">(self, key)</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>         <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">53</span>             <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">54</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">move_to_end</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="ne">KeyError</span>: [&lt;class &#39;netCDF4._netCDF4.Dataset&#39;&gt;, (&#39;http://thredds.atmos.albany.edu:8080/thredds/dodsC/cesm/som_input/USGS-gtopo30_1.9x2.5_remap_c050602.nc&#39;,), &#39;r&#39;, ((&#39;clobber&#39;, True), (&#39;diskless&#39;, False), (&#39;format&#39;, &#39;NETCDF4&#39;), (&#39;persist&#39;, False))]

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">OSError</span><span class="g g-Whitespace">                                   </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="mi">03</span><span class="n">dec145e854</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">datapath</span> <span class="o">=</span> <span class="s2">&quot;http://thredds.atmos.albany.edu:8080/thredds/dodsC/cesm/&quot;</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">topo</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">datapath</span><span class="o">+</span><span class="s1">&#39;som_input/USGS-gtopo30_1.9x2.5_remap_c050602.nc&#39;</span><span class="p">,</span> <span class="n">decode_times</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">runlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">,</span> <span class="s1">&#39;2xCO2&#39;</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">runs</span> <span class="o">=</span> <span class="p">{}</span>

<span class="nn">~/opt/anaconda3/envs/climlab-courseware/lib/python3.8/site-packages/xarray/backends/api.py</span> in <span class="ni">open_dataset</span><span class="nt">(filename_or_obj, group, decode_cf, mask_and_scale, decode_times, concat_characters, decode_coords, engine, chunks, lock, cache, drop_variables, backend_kwargs, use_cftime, decode_timedelta)</span>
<span class="g g-Whitespace">    </span><span class="mi">552</span> 
<span class="g g-Whitespace">    </span><span class="mi">553</span>         <span class="n">opener</span> <span class="o">=</span> <span class="n">_get_backend_cls</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">554</span>         <span class="n">store</span> <span class="o">=</span> <span class="n">opener</span><span class="p">(</span><span class="n">filename_or_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">backend_kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">555</span> 
<span class="g g-Whitespace">    </span><span class="mi">556</span>     <span class="k">with</span> <span class="n">close_on_error</span><span class="p">(</span><span class="n">store</span><span class="p">):</span>

<span class="nn">~/opt/anaconda3/envs/climlab-courseware/lib/python3.8/site-packages/xarray/backends/netCDF4_.py</span> in <span class="ni">open</span><span class="nt">(cls, filename, mode, format, group, clobber, diskless, persist, lock, lock_maker, autoclose)</span>
<span class="g g-Whitespace">    </span><span class="mi">376</span>             <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span>
<span class="g g-Whitespace">    </span><span class="mi">377</span>         <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">378</span>         <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">lock</span><span class="o">=</span><span class="n">lock</span><span class="p">,</span> <span class="n">autoclose</span><span class="o">=</span><span class="n">autoclose</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">379</span> 
<span class="g g-Whitespace">    </span><span class="mi">380</span>     <span class="k">def</span> <span class="nf">_acquire</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">needs_lock</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

<span class="nn">~/opt/anaconda3/envs/climlab-courseware/lib/python3.8/site-packages/xarray/backends/netCDF4_.py</span> in <span class="ni">__init__</span><span class="nt">(self, manager, group, mode, lock, autoclose)</span>
<span class="g g-Whitespace">    </span><span class="mi">324</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_group</span> <span class="o">=</span> <span class="n">group</span>
<span class="g g-Whitespace">    </span><span class="mi">325</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
<span class="ne">--&gt; </span><span class="mi">326</span>         <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">data_model</span>
<span class="g g-Whitespace">    </span><span class="mi">327</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">filepath</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">328</span>         <span class="bp">self</span><span class="o">.</span><span class="n">is_remote</span> <span class="o">=</span> <span class="n">is_remote_uri</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>

<span class="nn">~/opt/anaconda3/envs/climlab-courseware/lib/python3.8/site-packages/xarray/backends/netCDF4_.py</span> in <span class="ni">ds</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">385</span>     <span class="nd">@property</span>
<span class="g g-Whitespace">    </span><span class="mi">386</span>     <span class="k">def</span> <span class="nf">ds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">387</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquire</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">388</span> 
<span class="g g-Whitespace">    </span><span class="mi">389</span>     <span class="k">def</span> <span class="nf">open_store_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>

<span class="nn">~/opt/anaconda3/envs/climlab-courseware/lib/python3.8/site-packages/xarray/backends/netCDF4_.py</span> in <span class="ni">_acquire</span><span class="nt">(self, needs_lock)</span>
<span class="g g-Whitespace">    </span><span class="mi">379</span> 
<span class="g g-Whitespace">    </span><span class="mi">380</span>     <span class="k">def</span> <span class="nf">_acquire</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">needs_lock</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">381</span>         <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">acquire_context</span><span class="p">(</span><span class="n">needs_lock</span><span class="p">)</span> <span class="k">as</span> <span class="n">root</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">382</span>             <span class="n">ds</span> <span class="o">=</span> <span class="n">_nc4_require_group</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">383</span>         <span class="k">return</span> <span class="n">ds</span>

<span class="nn">~/opt/anaconda3/envs/climlab-courseware/lib/python3.8/contextlib.py</span> in <span class="ni">__enter__</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">111</span>         <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span>
<span class="g g-Whitespace">    </span><span class="mi">112</span>         <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">113</span>             <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gen</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">114</span>         <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">115</span>             <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;generator didn&#39;t yield&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>

<span class="nn">~/opt/anaconda3/envs/climlab-courseware/lib/python3.8/site-packages/xarray/backends/file_manager.py</span> in <span class="ni">acquire_context</span><span class="nt">(self, needs_lock)</span>
<span class="g g-Whitespace">    </span><span class="mi">185</span>     <span class="k">def</span> <span class="nf">acquire_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">needs_lock</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span>         <span class="sd">&quot;&quot;&quot;Context manager for acquiring a file.&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">187</span>         <span class="n">file</span><span class="p">,</span> <span class="n">cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquire_with_cache_info</span><span class="p">(</span><span class="n">needs_lock</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">188</span>         <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">189</span>             <span class="k">yield</span> <span class="n">file</span>

<span class="nn">~/opt/anaconda3/envs/climlab-courseware/lib/python3.8/site-packages/xarray/backends/file_manager.py</span> in <span class="ni">_acquire_with_cache_info</span><span class="nt">(self, needs_lock)</span>
<span class="g g-Whitespace">    </span><span class="mi">203</span>                     <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">204</span>                     <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>
<span class="ne">--&gt; </span><span class="mi">205</span>                 <span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_opener</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">206</span>                 <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">==</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">207</span>                     <span class="c1"># ensure file doesn&#39;t get overriden when opened again</span>

<span class="nn">src/netCDF4/_netCDF4.pyx</span> in <span class="ni">netCDF4._netCDF4.Dataset.__init__</span><span class="nt">()</span>

<span class="nn">src/netCDF4/_netCDF4.pyx</span> in <span class="ni">netCDF4._netCDF4._ensure_nc_success</span><span class="nt">()</span>

<span class="ne">OSError</span>: [Errno -72] NetCDF: Malformed or inaccessible DAP2 DDS or DAP4 DMR response: b&#39;http://thredds.atmos.albany.edu:8080/thredds/dodsC/cesm/som_input/USGS-gtopo30_1.9x2.5_remap_c050602.nc&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lat</span> <span class="o">=</span> <span class="n">runs</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lat</span>
<span class="n">lon</span> <span class="o">=</span> <span class="n">runs</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lon</span>
<span class="n">lev</span> <span class="o">=</span> <span class="n">runs</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lev</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">bac7bda987d2</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">runs</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lat</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">lon</span> <span class="o">=</span> <span class="n">runs</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lon</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">lev</span> <span class="o">=</span> <span class="n">runs</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lev</span>

<span class="ne">NameError</span>: name &#39;runs&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="annual-mean-surface-energy-budget">
<h3>Annual mean surface energy budget<a class="headerlink" href="#annual-mean-surface-energy-budget" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Surface energy budget terms, all defined as positive up (from ocean to atmosphere)</span>
<span class="n">surface_budget</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span> <span class="ow">in</span> <span class="n">runs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">budget</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
    <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;LHF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">LHFLX</span>
    <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;SHF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">SHFLX</span>
    <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;LWsfc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">FLNS</span>
    <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;LWsfc_clr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">FLNSC</span>
    <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;SWsfc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">run</span><span class="o">.</span><span class="n">FSNS</span>
    <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;SWsfc_clr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">run</span><span class="o">.</span><span class="n">FSNSC</span>
    <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;SnowFlux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">run</span><span class="o">.</span><span class="n">PRECSC</span><span class="o">+</span><span class="n">run</span><span class="o">.</span><span class="n">PRECSL</span><span class="p">)</span>
                           <span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">rho_w</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">Lhfus</span><span class="p">)</span>
    <span class="c1"># net upward radiation from surface</span>
    <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;NetRad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;LWsfc&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;SWsfc&#39;</span><span class="p">]</span>  
    <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;NetRad_clr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;LWsfc_clr&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;SWsfc_clr&#39;</span><span class="p">]</span>  
    <span class="c1"># net upward surface heat flux</span>
    <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;Net&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">budget</span><span class="p">[</span><span class="s1">&#39;NetRad&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;LHF&#39;</span><span class="p">]</span> <span class="o">+</span> 
                     <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;SHF&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;SnowFlux&#39;</span><span class="p">])</span>
    <span class="n">surface_budget</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">budget</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mi">406056</span><span class="n">c6f62c</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">surface_budget</span> <span class="o">=</span> <span class="p">{}</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span> <span class="ow">in</span> <span class="n">runs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">budget</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">budget</span><span class="p">[</span><span class="s1">&#39;LHF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">LHFLX</span>

<span class="ne">NameError</span>: name &#39;runs&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="compute-anomalies-for-all-terms">
<h3>Compute anomalies for all terms<a class="headerlink" href="#compute-anomalies-for-all-terms" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#   Here we take advantage of xarray!</span>
<span class="c1">#   We can simply subtract the two xarray.Dataset objects </span>
<span class="c1">#   to get anomalies for every term</span>
<span class="n">surface_budget</span><span class="p">[</span><span class="s1">&#39;anom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">surface_budget</span><span class="p">[</span><span class="s1">&#39;2xCO2&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">surface_budget</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">d3a2561f3c8a</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="c1">#   We can simply subtract the two xarray.Dataset objects</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1">#   to get anomalies for every term</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">surface_budget</span><span class="p">[</span><span class="s1">&#39;anom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">surface_budget</span><span class="p">[</span><span class="s1">&#39;2xCO2&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">surface_budget</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span>

<span class="ne">KeyError</span>: &#39;2xCO2&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Also compute zonal averages</span>
<span class="n">zonal_budget</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">run</span><span class="p">,</span> <span class="n">budget</span> <span class="ow">in</span> <span class="n">surface_budget</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">zonal_budget</span><span class="p">[</span><span class="n">run</span><span class="p">]</span> <span class="o">=</span> <span class="n">budget</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-the-annual-mean-net-upward-flux-f-s-control-and-anomaly-after-warming">
<h3>Plot the annual mean net upward flux <span class="math notranslate nohighlight">\(F_S\)</span> (control and anomaly after warming)<a class="headerlink" href="#plot-the-annual-mean-net-upward-flux-f-s-control-and-anomaly-after-warming" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">cax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">surface_budget</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Net</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">),</span>
                          <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">seismic</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">200.</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">200.</span> <span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Annual mean net surface heat flux (+ up) - CESM control&#39;</span><span class="p">)</span>
<span class="n">cax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">surface_budget</span><span class="p">[</span><span class="s1">&#39;anom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Net</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">),</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">seismic</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">20.</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">20.</span> <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Anomaly after CO2 doubling&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">topo</span><span class="o">.</span><span class="n">LANDFRAC</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="mi">33</span><span class="n">ff00ce576b</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">cax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">surface_budget</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Net</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">),</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>                           <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">seismic</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">200.</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">200.</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Annual mean net surface heat flux (+ up) - CESM control&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">cax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">surface_budget</span><span class="p">[</span><span class="s1">&#39;anom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Net</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">),</span>

<span class="ne">NameError</span>: name &#39;lon&#39; is not defined
</pre></div>
</div>
<img alt="../_images/surface-energy-balance_20_1.png" src="../_images/surface-energy-balance_20_1.png" />
</div>
</div>
<p>Some notable points about the control state:</p>
<ul class="simple">
<li><p>The net flux over all land surfaces is very close to zero!</p></li>
<li><p>In the long-term annual mean, a non-zero <span class="math notranslate nohighlight">\(F_S\)</span> must be balanced by heat transport.</p></li>
<li><p>The spatial pattern of <span class="math notranslate nohighlight">\(F_S\)</span> over the oceans is essentially just the prescribed q-flux that we have imposed on the slab ocean to represent ocean heat transport.</p></li>
<li><p>We have looked at maps like this before, back in [Lecture 15](./Lecture15 – Heat transport.ipynb) and [Assignment 2](../Assignments/Assignment02 – Introducing CESM.ipynb).</p></li>
<li><p>Net heat uptake by the oceans occurs mostly along the equator and the cold tongues on the eastern sides of the tropical basins.</p></li>
<li><p>Net heat release from oceans to atmosphere occurs mostly in mid- to high latitudes. Hot spots include the Gulf Stream and Kuroshio regions on the western sides of the mid-latitude basins, as well as the subpolar North Atlantic. These features are largely determined by ocean dynamics.</p></li>
</ul>
<p><strong>After greenhouse warming</strong>:</p>
<ul class="simple">
<li><p>The net change in <span class="math notranslate nohighlight">\(F_S\)</span> is very small in most locations.</p></li>
<li><p>This indicates that the model has reached quasi-equilibrium. Non-zero changes in <span class="math notranslate nohighlight">\(F_S\)</span> would indicate either</p>
<ul>
<li><p>heat storage below the surface</p></li>
<li><p>changes in ocean heat transport (not permitted in a slab ocean model).</p></li>
</ul>
</li>
<li><p>Non-zero changes are found in areas where the sea ice cover is changing in the model.</p></li>
</ul>
</div>
<div class="section" id="variation-of-energy-balance-components-with-latitude">
<h3>Variation of energy balance components with latitude<a class="headerlink" href="#variation-of-energy-balance-components-with-latitude" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fieldlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SWsfc&#39;</span><span class="p">,</span> <span class="s1">&#39;LWsfc&#39;</span><span class="p">,</span> <span class="s1">&#39;LHF&#39;</span><span class="p">,</span> <span class="s1">&#39;SHF&#39;</span><span class="p">,</span> <span class="s1">&#39;Net&#39;</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">run</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">,</span> <span class="s1">&#39;anom&#39;</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fieldlist</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">zonal_budget</span><span class="p">[</span><span class="n">run</span><span class="p">][</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">field</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">();</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Components of ANNUAL surface energy budget (+ up) - CESM control&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Anomaly after CO2 doubling&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="n">ebca4a705d0c</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">run</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">,</span> <span class="s1">&#39;anom&#39;</span><span class="p">]):</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fieldlist</span><span class="p">:</span>
<span class="ne">----&gt; </span><span class="mi">5</span>         <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">zonal_budget</span><span class="p">[</span><span class="n">run</span><span class="p">][</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">field</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">();</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Components of ANNUAL surface energy budget (+ up) - CESM control&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;lat&#39; is not defined
</pre></div>
</div>
<img alt="../_images/surface-energy-balance_24_1.png" src="../_images/surface-energy-balance_24_1.png" />
</div>
</div>
<p>In these graphs, the curve labeled “Net” is the net flux <span class="math notranslate nohighlight">\(F_S\)</span>. It is just the zonal average of the maps from the previous figure, and shows the ocean heat uptake at the equator and release in mid- to high latitudes.</p>
<p>More interestingly, these graphs show the contribution of the various terms to <span class="math notranslate nohighlight">\(F_S\)</span>. They are all plotted as positive up. A <strong>negative</strong> value thus indicates <strong>heating of the surface</strong>, and a <strong>positive</strong> value indicates a <strong>cooling of the surface</strong>.</p>
<p>Key points about the control simulation:</p>
<ul class="simple">
<li><p>Solar radiation acts to warm the surface everywhere.</p></li>
<li><p>Note that this is a net shortwave flux, so it is the amount that is actually absorbed by the surface after accounting for the reflected fraction.</p></li>
<li><p>All other mechanisms act to cool the surface.</p></li>
<li><p>The dominant balance across the <strong>tropics</strong> is between <strong>warming by solar radiation</strong> and <strong>cooling by evaporation</strong> (latent heat flux or LHF).</p></li>
<li><p>The latent heat flux decreases poleward.</p></li>
<li><p>Latent heat flux is dominant over sensible heat flux at most latitudes except close to the poles.</p></li>
<li><p>The net longwave radiation also acts to cool the surface.</p></li>
<li><p>This is the residual between the surface emissions (essentially <span class="math notranslate nohighlight">\(\sigma~T_s^4\)</span>) and the back-radiation from the atmosphere.</p></li>
</ul>
<p><strong>After greenhouse warming</strong></p>
<ul class="simple">
<li><p>The anomaly in net upward longwave radiation is negative at most latitudes.</p></li>
<li><p>This implies that the downwelling back-radiation increases faster than the upwelling surface emissions.</p></li>
<li><p>This is a signature of greenhouse warming! Both the upwelling and downwelling beams increase with warming. But the downwelling beam also increases because of the CO<span class="math notranslate nohighlight">\(_2\)</span>-induced increase in emissivity of the atmosphere.</p></li>
<li><p>So the surface is warmed by excess longwave radiation.</p></li>
<li><p>This warming is largely balanced by increased evaporation (red curve)!</p></li>
<li><p>There are also significant changes in shortwave radiation. We could use the modeled clear-sky diagnostics to infer which of these changes are due to clouds.</p></li>
<li><p>The negative shortwave anomalies in high latitudes are consistent with surface albedo feedback and loss of ice and snow.</p></li>
</ul>
</div>
<div class="section" id="seasonal-variations">
<h3>Seasonal variations<a class="headerlink" href="#seasonal-variations" title="Permalink to this headline">¶</a></h3>
<p>We will compute the budgets for the months of January and July, and plot their differences.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  July minus January</span>
<span class="n">julminusjan_budget</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">budget</span> <span class="ow">in</span> <span class="n">surface_budget</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="c1">#  xarray.Dataset objects let you &quot;select&quot; a subset in various ways</span>
    <span class="c1">#  Here we are using the integer time index (0-11)</span>
    <span class="n">julminusjan_budget</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">budget</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="n">budget</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fieldlist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SWsfc&#39;</span><span class="p">,</span> <span class="s1">&#39;LWsfc&#39;</span><span class="p">,</span> <span class="s1">&#39;LHF&#39;</span><span class="p">,</span> <span class="s1">&#39;SHF&#39;</span><span class="p">,</span> <span class="s1">&#39;Net&#39;</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fieldlist</span><span class="p">:</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">julminusjan_budget</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">][</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">field</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Components of JUL-JAN surface energy budget (+ up) - CESM control&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fieldlist</span><span class="p">:</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">julminusjan_budget</span><span class="p">[</span><span class="s1">&#39;anom&#39;</span><span class="p">][</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">field</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Anomaly after CO2 doubling&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">becda2c69c21</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fieldlist</span><span class="p">:</span>
<span class="ne">----&gt; </span><span class="mi">4</span>     <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">julminusjan_budget</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">][</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">field</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Components of JUL-JAN surface energy budget (+ up) - CESM control&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fieldlist</span><span class="p">:</span>

<span class="ne">NameError</span>: name &#39;lat&#39; is not defined
</pre></div>
</div>
<img alt="../_images/surface-energy-balance_30_1.png" src="../_images/surface-energy-balance_30_1.png" />
</div>
</div>
<p>Seasonally, the dominant balance by far is between solar radiation and heat storage!</p>
<hr class="docutils" />
<p><a id='section3'></a></p>
</div>
</div>
<div class="section" id="sensible-and-latent-heat-fluxes-in-the-boundary-layer">
<h2>3. Sensible and Latent Heat Fluxes in the boundary layer<a class="headerlink" href="#sensible-and-latent-heat-fluxes-in-the-boundary-layer" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<p>These notes largely follow Chapter 4 of Hartmann (1994) “Global Physical Climatology”, Academic Press.</p>
<p>Turbulent fluxes of heat: eddy fluxes of heat and moisture at some level in the atmospheric boundary layer</p>
<div class="math notranslate nohighlight">
\[ \text{SH} = c_p ~\rho ~ \overline{w^\prime T^\prime} \]</div>
<div class="math notranslate nohighlight">
\[ \text{LE} = L ~\rho ~\overline{w^\prime q^\prime} \]</div>
<p>where <span class="math notranslate nohighlight">\(c_p\)</span> is the specific heat of air at constant pressure, <span class="math notranslate nohighlight">\(L\)</span> is the latent heat of vaporization, <span class="math notranslate nohighlight">\(\text{SH}\)</span> is the sensible heat flux and <span class="math notranslate nohighlight">\(\text{LE}\)</span> is the latent heat flux.</p>
<div class="section" id="bulk-aerodynamic-formulas">
<h3>Bulk aerodynamic formulas<a class="headerlink" href="#bulk-aerodynamic-formulas" title="Permalink to this headline">¶</a></h3>
<p>From theory of boundary layer turbulence, we suppose that the eddy heat fluxes is related to boundary layer temperature gradients, as well as the mean wind speed:</p>
<div class="math notranslate nohighlight">
\[ \text{SH} = c_p ~\rho ~ C_D ~ U \left( T_s - T_a \right) \]</div>
<p>where <span class="math notranslate nohighlight">\(T_s\)</span> is the surface temperature and <span class="math notranslate nohighlight">\(T_a\)</span> is the air temperature at some reference height above the surface. <span class="math notranslate nohighlight">\(U\)</span> is the wind speed at the reference height, and <span class="math notranslate nohighlight">\(C_D\)</span> is a dimensionless aerodynamic drag coefficient.</p>
<p><span class="math notranslate nohighlight">\(C_D\)</span> will depend, among other things, on the roughness of the surface.</p>
<p>Similarly, we assume that the latent heat flux is related to boundary layer moisture gradients:</p>
<div class="math notranslate nohighlight">
\[ \text{LE} = L ~\rho ~ C_D ~ U \left( q_s - q_a \right) \]</div>
<p>where <span class="math notranslate nohighlight">\(q_s\)</span> is the specific humidity of air immediately above the surface, and <span class="math notranslate nohighlight">\(q_a\)</span> is the specific humidity at the reference height.</p>
<p>In general the transfer coefficients <span class="math notranslate nohighlight">\(C_D\)</span> could be different for sensible and latent heat flux, but empirically they are found to be very similar to each other. We will assume they are equal here.</p>
</div>
<div class="section" id="the-bowen-ratio">
<h3>The Bowen ratio<a class="headerlink" href="#the-bowen-ratio" title="Permalink to this headline">¶</a></h3>
<p>The <strong>Bowen ratio</strong> is a dimensionless number defined as</p>
<div class="math notranslate nohighlight">
\[  B_o = \frac{\text{SH}}{\text{LE}} \]</div>
<p>i.e. the ratio of <strong>sensible heat loss</strong> to <strong>evaporative cooling</strong>.</p>
<p>From the above plots, the Bowen ratio tends to be small in the low latitudes.</p>
</div>
<div class="section" id="the-bowen-ratio-for-wet-surfaces">
<h3>The Bowen ratio for wet surfaces<a class="headerlink" href="#the-bowen-ratio-for-wet-surfaces" title="Permalink to this headline">¶</a></h3>
<p>Over a water surface or a very wet land surface, we may assume that the mixing ratio of water vapor at the surface is equal to the saturation mixing ratio <span class="math notranslate nohighlight">\(q^*\)</span> at the temperature of the surface:</p>
<div class="math notranslate nohighlight">
\[ q_s = q^*(T_s) \]</div>
<p>Recall that the saturation vapor pressure <span class="math notranslate nohighlight">\(q^*\)</span> is a sensitive function of temperature through the Clausius-Claperyon relation. (It also depends on pressure)</p>
<p>Let’s approximate the mixing ratio for <strong>saturated air</strong> at the reference height through a first-order Taylor series expansion:</p>
<div class="math notranslate nohighlight">
\[ q_a^* \approx q_s^*(T_s) + \frac{\partial q^*}{\partial T} \left( T_a - T_s \right) \]</div>
<p>The actual mixing ratio at the reference height can be expressed as</p>
<div class="math notranslate nohighlight">
\[ q_a = r ~ q_a^* \]</div>
<p>where <span class="math notranslate nohighlight">\(r\)</span> is the relative humidity at that level.</p>
<p>Then we have an appoximation for <span class="math notranslate nohighlight">\(q_a\)</span> in terms of temperature gradients:</p>
<div class="math notranslate nohighlight">
\[ q_a \approx r \left( q_s^*(T_s) + \frac{\partial q^*}{\partial T} \left( T_a - T_s \right) \right) \]</div>
<p>Substituting this into the bulk formula for latent heat flux, we get</p>
<div class="math notranslate nohighlight">
\[ \text{LE} \approx L ~\rho ~ C_D ~ U \left( q_s^* - r \left( q_s^* + \frac{\partial q^*}{\partial T} \left( T_a - T_s \right) \right) \right) \]</div>
<p>or, rearranging a bit,</p>
<div class="math notranslate nohighlight">
\[ \text{LE} \approx L ~\rho ~ C_D ~ U \left( (1-r) ~ q_s^* + r \frac{\partial q^*}{\partial T} \left( T_s - T_a \right) \right)  \]</div>
<p>The Bowen ratio is thus</p>
<div class="math notranslate nohighlight">
\[ B_o = \frac{c_p}{ L \left( \frac{(1-r)}{\left( T_s - T_a \right)} q_s^* + r \frac{\partial q^*}{\partial T} \right)} \]</div>
</div>
<div class="section" id="the-equilibrium-bowen-ratio-for-saturated-air">
<h3>The equilibrium Bowen ratio (for saturated air)<a class="headerlink" href="#the-equilibrium-bowen-ratio-for-saturated-air" title="Permalink to this headline">¶</a></h3>
<p>Notice that <strong>if the boundary layer air is saturated</strong>, then <span class="math notranslate nohighlight">\(r=1\)</span> and the Bowen ratio takes on a special value</p>
<div class="math notranslate nohighlight">
\[ B_e = \frac{c_p}{ L \frac{\partial q^*}{\partial T} } \]</div>
<p>When the surface and the air at the reference level are saturated, the Bowen ratio approaches the value <span class="math notranslate nohighlight">\(B_e\)</span>, which is called the equilibrium Bowen ratio. We presume that the flux of moisture from the boundary layer to the free atmosphere is sufficient to just balance the upward flux of moisture from the surface so that the humidity at the reference height is in equilibrium at the saturation value.</p>
<p>Recall that from the Clausius-Claperyon relation, the rate of change of the saturation mixing ratio is itself a strong function of temperature:</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial q^*}{\partial T} = q^*(T) \frac{L}{R_v ~ T^2} \]</div>
<p>Here the quasi-exponential dependence of <span class="math notranslate nohighlight">\(q^*\)</span> on <span class="math notranslate nohighlight">\(T\)</span> far outweighs the inverse square dependence, so the <strong>equilibrium Bowen ratio decreases roughly exponentially with temperature</strong>.</p>
<p>The following code reproduces Figure 4.10 of Hartmann (1994).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">climlab.utils.thermo</span> <span class="kn">import</span> <span class="n">qsat</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span> <span class="o">+</span> <span class="n">const</span><span class="o">.</span><span class="n">tempCtoK</span>
<span class="n">qstar</span> <span class="o">=</span> <span class="n">qsat</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">const</span><span class="o">.</span><span class="n">ps</span><span class="p">)</span>  <span class="c1"># in kg / kg</span>

<span class="k">def</span> <span class="nf">Be</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
    <span class="n">qstar</span> <span class="o">=</span> <span class="n">qsat</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">const</span><span class="o">.</span><span class="n">ps</span><span class="p">)</span>  <span class="c1"># in kg / kg</span>
    <span class="n">dqstardT</span> <span class="o">=</span> <span class="n">qstar</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">Lhvap</span> <span class="o">/</span> <span class="n">const</span><span class="o">.</span><span class="n">Rv</span> <span class="o">/</span> <span class="n">T</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">const</span><span class="o">.</span><span class="n">cp</span> <span class="o">/</span> <span class="n">const</span><span class="o">.</span><span class="n">Lhvap</span> <span class="o">/</span> <span class="n">dqstardT</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">const</span><span class="o">.</span><span class="n">tempKtoC</span><span class="p">,</span> <span class="n">qstar</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$q^*$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">const</span><span class="o">.</span><span class="n">tempKtoC</span><span class="p">,</span> <span class="n">Be</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$B_e$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Temperature (degC)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Saturation specific humidity (g/kg) and equilibrium Bowen ratio&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/surface-energy-balance_47_0.png" src="../_images/surface-energy-balance_47_0.png" />
</div>
</div>
<ul class="simple">
<li><p>Equilibrium Bowen ratio is near 1 at 0ºC, and decreases to about 0.2 at 30ºC.</p></li>
<li><p>As relative humidity is decreased from 1 to smaller values, <strong>evaporative cooling increases</strong>.</p></li>
<li><p>The equilibrium Bowen ratio is the <strong>maximum possible Bowen ratio for a wet surface</strong>.</p></li>
<li><p>Actual Bowen ratio over a wet surface will generally be smaller than <span class="math notranslate nohighlight">\(B_e\)</span>, because the air is usually not saturated.</p></li>
<li><p>Because of the strong temperature dependence of the saturation specific humidity:</p>
<ul>
<li><p>Evaporative cooling (latent heat flux) dominates over sensible cooling of wet surfaces at <strong>tropical</strong> temperatures.</p></li>
<li><p>Sensible heat flux becomes important wherever the surface is either <strong>cold</strong> or <strong>dry</strong>.</p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
<p><a id='section4'></a></p>
</div>
</div>
<div class="section" id="bowen-ratio-in-cesm-simulations">
<h2>4. Bowen ratio in CESM simulations<a class="headerlink" href="#bowen-ratio-in-cesm-simulations" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Bo_control</span> <span class="o">=</span> <span class="p">(</span><span class="n">surface_budget</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">SHF</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span> <span class="o">/</span> 
              <span class="n">surface_budget</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">LHF</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">))</span>
<span class="n">Be_control</span> <span class="o">=</span> <span class="n">Be</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TS</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">cax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">Bo_control</span><span class="p">,</span>
                    <span class="n">vmin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">5.</span> <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$B_o$ (CESM control)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">Be_control</span><span class="p">,</span>
                    <span class="n">vmin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">5.</span> <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$B_e$ (CESM control)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cax3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="p">(</span><span class="n">Bo_control</span> <span class="o">-</span> <span class="n">Be_control</span><span class="p">),</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;seismic&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">10.</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">10.</span> <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$B_o - B_e$ (CESM control)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">topo</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;LANDFRAC&#39;</span><span class="p">][:],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">13</span><span class="o">-</span><span class="mf">9397e015</span><span class="n">c0b5</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">Bo_control</span> <span class="o">=</span> <span class="p">(</span><span class="n">surface_budget</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">SHF</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span> <span class="o">/</span> 
<span class="g g-Whitespace">      </span><span class="mi">2</span>               <span class="n">surface_budget</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">LHF</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">Be_control</span> <span class="o">=</span> <span class="n">Be</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TS</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> 
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="ne">KeyError</span>: &#39;control&#39;
</pre></div>
</div>
</div>
</div>
<p>On the difference plot, the blue colors indicate the actual Bowen ratio is smaller than the equilibrium Bowen ratio. This will typically occur for <strong>wet surfaces</strong> with <strong>undersaturated air</strong>.</p>
<p>The red colors indicate the actual Bowen ratio is larger than the equilibrium Bowen ratio. This typically occurs for <strong>dry surfaces</strong> where there is not enough water available to satisfy the energetic demand for evaporation.</p>
</div>
<hr class="docutils" />
<div class="section" id="credits">
<h2>Credits<a class="headerlink" href="#credits" title="Permalink to this headline">¶</a></h2>
<p>This notebook is part of <a class="reference external" href="https://brian-rose.github.io/ClimateLaboratoryBook">The Climate Laboratory</a>, an open-source textbook developed and maintained by <a class="reference external" href="http://www.atmos.albany.edu/facstaff/brose/index.html">Brian E. J. Rose</a>, University at Albany.</p>
<p>It is licensed for free and open consumption under the
<a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International (CC BY 4.0)</a> license.</p>
<p>Development of these notes and the <a class="reference external" href="https://github.com/brian-rose/climlab">climlab software</a> is partially supported by the National Science Foundation under award AGS-1455071 to Brian Rose. Any opinions, findings, conclusions or recommendations expressed here are mine and do not necessarily reflect the views of the National Science Foundation.</p>
<hr class="docutils" />
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./courseware"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="advanced-snowball-earth.html" title="previous page">Advanced topic: Snowball Earth and Large Ice Cap Instability in the EBM</a>
    <a class='right-next' id="next-link" href="land-ocean-contrast.html" title="next page"><span class="section-number">25. </span>Land-Ocean contrasts under climate change</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Brian E. J. Rose<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-43758959-2', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    
  </body>
</html>